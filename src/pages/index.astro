---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import MainNewsCard from "../components/MainNewsCard.astro";
import NewsList from "../components/NewsList.astro";

const politikkPosts = await getCollection("Politikk");
const kulturPosts = await getCollection("Kultur");
const foreignAffairsPosts = await getCollection("Utenriks");
const meningPosts = await getCollection("Mening");
const naringslivPosts = await getCollection("Naringsliv");

const allPosts = [
  ...politikkPosts.map((post) => ({ ...post, collection: "Politikk" })),
  ...kulturPosts.map((post) => ({ ...post, collection: "Kultur" })),
  ...foreignAffairsPosts.map((post) => ({ ...post, collection: "Utenriks" })),
  ...meningPosts.map((post) => ({ ...post, collection: "Mening" })),
  ...naringslivPosts.map((post) => ({ ...post, collection: "Naringsliv" })),
];

allPosts.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);

const [mainNews, ...remainingposts] = allPosts;
---

<BaseLayout currentTab="Alt">
  {
    (
      <MainNewsCard
        title={mainNews.data.title}
        description={mainNews.data.description}
        image={mainNews.data.image}
        url={`${mainNews.collection}/${mainNews.slug}/`}
      />
    )
  }
  {(<NewsList remainingposts={remainingposts} />)}
</BaseLayout>
